<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Sobreaviso DRV/DEIC</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: #f5f5f5;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: #2563eb;
            color: white;
            padding: 30px 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }

        .tabs {
            display: flex;
            background: #f0f0f0;
            border-bottom: 2px solid #ddd;
        }

        .tab-btn {
            flex: 1;
            padding: 15px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            color: #666;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }

        .tab-btn.active {
            background: white;
            color: #2563eb;
            border-bottom-color: #2563eb;
        }

        .tab-btn:hover {
            background: #f9f9f9;
        }

        .content {
            padding: 30px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: #333;
        }

        select, textarea {
            width: 100%;
            padding: 12px;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            font-family: Arial, sans-serif;
        }

        select {
            cursor: pointer;
        }

        textarea {
            height: 350px;
            resize: vertical;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }

        .swap-container {
            background: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .swap-row {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 12px;
            align-items: end;
            margin-bottom: 12px;
        }

        .swap-row:last-child {
            margin-bottom: 0;
        }

        .swap-row label {
            margin-bottom: 5px;
        }

        .swap-row select {
            margin-bottom: 0;
        }

        .swap-arrow {
            text-align: center;
            font-weight: bold;
            color: #2563eb;
            font-size: 18px;
        }

        .buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 15px;
            font-weight: bold;
            transition: all 0.3s;
            flex: 1;
            min-width: 120px;
        }

        .btn-copy {
            background: #2563eb;
            color: white;
        }

        .btn-copy:hover {
            background: #1d4ed8;
        }

        .btn-whatsapp {
            background: #16a34a;
            color: white;
        }

        .btn-whatsapp:hover {
            background: #15803d;
        }

        .btn-clear {
            background: #6b7280;
            color: white;
        }

        .btn-clear:hover {
            background: #4b5563;
        }

        @media (max-width: 600px) {
            .header h1 {
                font-size: 20px;
            }

            .tabs {
                flex-direction: column;
            }

            textarea {
                height: 250px;
            }

            button {
                min-width: 100%;
            }

            .tab-btn {
                font-size: 14px;
                padding: 10px;
            }

            .swap-row {
                grid-template-columns: 1fr;
            }

            .swap-arrow {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìã Gerador de Sobreaviso DRV/DEIC</h1>
        </div>

        <div class="tabs">
            <button class="tab-btn active" onclick="showTab(0)">üìÖ Buscar por Data</button>
            <button class="tab-btn" onclick="showTab(1)">üë§ Buscar por Pessoa</button>
            <button class="tab-btn" onclick="showTab(2)">üîÑ Trocas</button>
        </div>

        <div class="content">
            <!-- ABA 1: BUSCAR POR DATA -->
            <div class="tab-content active">
                <label for="date-select">Selecione a data:</label>
                <select id="date-select" onchange="searchByDate()">
                    <option value="">-- Escolha uma data --</option>
                    <option>01/11/2025</option>
                    <option>02/11/2025</option>
                    <option>03/11/2025</option>
                    <option>04/11/2025</option>
                    <option>05/11/2025</option>
                    <option>06/11/2025</option>
                    <option>07/11/2025</option>
                    <option>08/11/2025</option>
                    <option>09/11/2025</option>
                    <option>10/11/2025</option>
                    <option>11/11/2025</option>
                    <option>12/11/2025</option>
                    <option>13/11/2025</option>
                    <option>14/11/2025</option>
                    <option>15/11/2025</option>
                    <option>16/11/2025</option>
                    <option>17/11/2025</option>
                    <option>18/11/2025</option>
                    <option>19/11/2025</option>
                    <option>20/11/2025</option>
                    <option>21/11/2025</option>
                    <option>22/11/2025</option>
                    <option>23/11/2025</option>
                    <option>24/11/2025</option>
                    <option>25/11/2025</option>
                    <option>26/11/2025</option>
                    <option>27/11/2025</option>
                    <option>28/11/2025</option>
                    <option>29/11/2025</option>
                    <option>30/11/2025</option>
                    <option>01/12/2025</option>
                    <option>02/12/2025</option>
                    <option>03/12/2025</option>
                    <option>04/12/2025</option>
                    <option>05/12/2025</option>
                    <option>06/12/2025</option>
                    <option>07/12/2025</option>
                    <option>08/12/2025</option>
                    <option>09/12/2025</option>
                    <option>10/12/2025</option>
                    <option>11/12/2025</option>
                    <option>12/12/2025</option>
                    <option>13/12/2025</option>
                    <option>14/12/2025</option>
                    <option>15/12/2025</option>
                    <option>16/12/2025</option>
                    <option>17/12/2025</option>
                    <option>18/12/2025</option>
                    <option>19/12/2025</option>
                    <option>20/12/2025</option>
                    <option>21/12/2025</option>
                    <option>22/12/2025</option>
                    <option>23/12/2025</option>
                    <option>24/12/2025</option>
                    <option>25/12/2025</option>
                    <option>26/12/2025</option>
                    <option>27/12/2025</option>
                    <option>28/12/2025</option>
                    <option>29/12/2025</option>
                    <option>30/12/2025</option>
                    <option>31/12/2025</option>
                </select>
            </div>

            <!-- ABA 2: BUSCAR POR PESSOA -->
            <div class="tab-content">
                <label for="person-select">Selecione uma pessoa:</label>
                <select id="person-select" onchange="searchByPerson()">
                    <option value="">-- Escolha uma pessoa --</option>
                    <option>Insp. Acau√£</option>
                    <option>Insp. Alexandre Brozoza</option>
                    <option>Esc. Anderson Saraiva</option>
                    <option>Esc. C√°tia Fortunato</option>
                    <option>Esc. C√©sar da Costa</option>
                    <option>Insp. Cristiano Soletti</option>
                    <option>Esc. Dagoberto O. das Virgens</option>
                    <option>Insp. Edmilson Melo</option>
                    <option>Insp. Edna Moraes</option>
                    <option>Esc. Fernanda Piazza</option>
                    <option>Insp. Guilherme Mello</option>
                    <option>Esc. Jefferson Antoniol</option>
                    <option>Insp. Juliana Tremper</option>
                    <option>Insp. Juliano Bonacina</option>
                    <option>Insp. Lucas Loss</option>
                    <option>Esc. Luciana Bortoli</option>
                    <option>Insp. Tais Boesing</option>
                    <option>Insp. Teresinha Carivali</option>
                    <option>Insp. Th√°ssia Guterres</option>
                    <option>Insp. Thiago Meireles</option>
                    <option>Insp. Vanessa Trindade</option>
                </select>
            </div>

            <!-- ABA 3: TROCAS -->
            <div class="tab-content">
                <label for="swap-date-select">Selecione a data da troca:</label>
                <select id="swap-date-select" onchange="loadSwapOptions()">
                    <option value="">-- Escolha uma data --</option>
                    <option>01/11/2025</option>
                    <option>02/11/2025</option>
                    <option>03/11/2025</option>
                    <option>04/11/2025</option>
                    <option>05/11/2025</option>
                    <option>06/11/2025</option>
                    <option>07/11/2025</option>
                    <option>08/11/2025</option>
                    <option>09/11/2025</option>
                    <option>10/11/2025</option>
                    <option>11/11/2025</option>
                    <option>12/11/2025</option>
                    <option>13/11/2025</option>
                    <option>14/11/2025</option>
                    <option>15/11/2025</option>
                    <option>16/11/2025</option>
                    <option>17/11/2025</option>
                    <option>18/11/2025</option>
                    <option>19/11/2025</option>
                    <option>20/11/2025</option>
                    <option>21/11/2025</option>
                    <option>22/11/2025</option>
                    <option>23/11/2025</option>
                    <option>24/11/2025</option>
                    <option>25/11/2025</option>
                    <option>26/11/2025</option>
                    <option>27/11/2025</option>
                    <option>28/11/2025</option>
                    <option>29/11/2025</option>
                    <option>30/11/2025</option>
                    <option>01/12/2025</option>
                    <option>02/12/2025</option>
                    <option>03/12/2025</option>
                    <option>04/12/2025</option>
                    <option>05/12/2025</option>
                    <option>06/12/2025</option>
                    <option>07/12/2025</option>
                    <option>08/12/2025</option>
                    <option>09/12/2025</option>
                    <option>10/12/2025</option>
                    <option>11/12/2025</option>
                    <option>12/12/2025</option>
                    <option>13/12/2025</option>
                    <option>14/12/2025</option>
                    <option>15/12/2025</option>
                    <option>16/12/2025</option>
                    <option>17/12/2025</option>
                    <option>18/12/2025</option>
                    <option>19/12/2025</option>
                    <option>20/12/2025</option>
                    <option>21/12/2025</option>
                    <option>22/12/2025</option>
                    <option>23/12/2025</option>
                    <option>24/12/2025</option>
                    <option>25/12/2025</option>
                    <option>26/12/2025</option>
                    <option>27/12/2025</option>
                    <option>28/12/2025</option>
                    <option>29/12/2025</option>
                    <option>30/12/2025</option>
                    <option>31/12/2025</option>
                </select>

                <div class="swap-container" id="swap-options-container" style="display: none;">
                    <div class="swap-row">
                        <div>
                            <label for="swap-person-1">Quem est√°:</label>
                            <select id="swap-person-1" onchange="updateSwapMessage()">
                                <option value="">-- Selecione --</option>
                            </select>
                        </div>
                        <div class="swap-arrow">‚Üí</div>
                        <div>
                            <label for="swap-for-1">Vai trocar para:</label>
                            <select id="swap-for-1" onchange="updateSwapMessage()">
                                <option value="">-- Selecione --</option>
                            </select>
                        </div>
                    </div>

                    <div class="swap-row">
                        <div>
                            <label for="swap-person-2">Quem est√°:</label>
                            <select id="swap-person-2" onchange="updateSwapMessage()">
                                <option value="">-- Selecione --</option>
                            </select>
                        </div>
                        <div class="swap-arrow">‚Üí</div>
                        <div>
                            <label for="swap-for-2">Vai trocar para:</label>
                            <select id="swap-for-2" onchange="updateSwapMessage()">
                                <option value="">-- Selecione --</option>
                            </select>
                        </div>
                    </div>

                    <div class="swap-row">
                        <div>
                            <label for="swap-person-3">Quem est√°:</label>
                            <select id="swap-person-3" onchange="updateSwapMessage()">
                                <option value="">-- Selecione --</option>
                            </select>
                        </div>
                        <div class="swap-arrow">‚Üí</div>
                        <div>
                            <label for="swap-for-3">Vai trocar para:</label>
                            <select id="swap-for-3" onchange="updateSwapMessage()">
                                <option value="">-- Selecione --</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <textarea id="output" placeholder="O texto do sobreaviso aparecer√° aqui..." readonly></textarea>

            <div class="buttons">
                <button class="btn-copy" onclick="copyText()">üìã Copiar Texto</button>
                <button class="btn-whatsapp" onclick="sendWhatsApp()">üíö Enviar no WhatsApp</button>
                <button class="btn-clear" onclick="clearAll()">üóëÔ∏è Limpar</button>
            </div>
        </div>
    </div>

    <script>
        let lastSelectedDate = null;

        const nameMap = {
            "Cau": "Insp. Acau√£",
            "Piazza": "Esc. Fernanda Piazza",
            "Cristiano": "Insp. Cristiano Soletti",
            "Teresinha": "Insp. Teresinha Carivali",
            "Thiago": "Insp. Thiago Meireles",
            "C√©sar": "Esc. C√©sar da Costa",
            "Vanessa": "Insp. Vanessa Trindade",
            "Bona": "Insp. Juliano Bonacina",
            "Gui Mello": "Insp. Guilherme Mello",
            "Tais": "Insp. Tais Boesing",
            "Jeff": "Esc. Jefferson Antoniol",
            "Luciana": "Esc. Luciana Bortoli",
            "Edna": "Insp. Edna Moraes",
            "Saraiva": "Esc. Anderson Saraiva",
            "Loss": "Insp. Lucas Loss",
            "Brozoza": "Insp. Alexandre Brozoza",
            "Dago": "Esc. Dagoberto O. das Virgens",
            "Th√°ssia": "Insp. Th√°ssia Guterres",
            "Juliana": "Insp. Juliana Tremper",
            "C√°tia": "Esc. C√°tia Fortunato",
            "Melo": "Insp. Edmilson Melo"
        };

        const phoneMap = {
            "Cau": "(51) 986859065",
            "Piazza": "(51) 993605744",
            "Cristiano": "(51) 995659880",
            "Teresinha": "(51) 999829606",
            "Thiago": "(79) 988080613",
            "C√©sar": "(51) 998911160",
            "Vanessa": "(55) 984278960",
            "Bona": "(51) 989276060",
            "Gui Mello": "(51) 981354933",
            "Tais": "(51) 980549435",
            "Jeff": "(24) 981002933",
            "Luciana": "(51) 993935552",
            "Edna": "(53) 981339654",
            "Saraiva": "(51) 993879343",
            "Loss": "(51) 991055571",
            "Brozoza": "(51) 996500506",
            "Dago": "(51) 999920066",
            "Th√°ssia": "(51) 996499862",
            "Juliana": "(51) 993337587",
            "C√°tia": "(51) 985744501",
            "Melo": "(51) 983190815"
        };

        const peopleShortMap = {
            "Insp. Acau√£": "Cau",
            "Insp. Alexandre Brozoza": "Brozoza",
            "Esc. Anderson Saraiva": "Saraiva",
            "Esc. C√°tia Fortunato": "C√°tia",
            "Esc. C√©sar da Costa": "C√©sar",
            "Insp. Cristiano Soletti": "Cristiano",
            "Esc. Dagoberto O. das Virgens": "Dago",
            "Insp. Edmilson Melo": "Melo",
            "Insp. Edna Moraes": "Edna",
            "Esc. Fernanda Piazza": "Piazza",
            "Insp. Guilherme Mello": "Gui Mello",
            "Esc. Jefferson Antoniol": "Jeff",
            "Insp. Juliana Tremper": "Juliana",
            "Insp. Juliano Bonacina": "Bona",
            "Insp. Lucas Loss": "Loss",
            "Esc. Luciana Bortoli": "Luciana",
            "Insp. Tais Boesing": "Tais",
            "Insp. Teresinha Carivali": "Teresinha",
            "Insp. Th√°ssia Guterres": "Th√°ssia",
            "Insp. Thiago Meireles": "Thiago",
            "Insp. Vanessa Trindade": "Vanessa"
        };

        const allPeople = [
            "Insp. Acau√£",
            "Insp. Alexandre Brozoza",
            "Esc. Anderson Saraiva",
            "Esc. C√°tia Fortunato",
            "Esc. C√©sar da Costa",
            "Insp. Cristiano Soletti",
            "Esc. Dagoberto O. das Virgens",
            "Insp. Edmilson Melo",
            "Insp. Edna Moraes",
            "Esc. Fernanda Piazza",
            "Insp. Guilherme Mello",
            "Esc. Jefferson Antoniol",
            "Insp. Juliana Tremper",
            "Insp. Juliano Bonacina",
            "Insp. Lucas Loss",
            "Esc. Luciana Bortoli",
            "Insp. Tais Boesing",
            "Insp. Teresinha Carivali",
            "Insp. Th√°ssia Guterres",
            "Insp. Thiago Meireles",
            "Insp. Vanessa Trindade"
        ];

        const schedule = {
            "01/11/2025": ["Cristiano", "Vanessa", "Thiago"],
            "02/11/2025": ["Cristiano", "Vanessa", "Thiago"],
            "03/11/2025": ["Piazza", "C√©sar", "Vanessa"],
            "04/11/2025": ["Bona", "Vanessa", "Saraiva"],
            "05/11/2025": ["Dago", "Th√°ssia", "Thiago"],
            "06/11/2025": ["Jeff", "Teresinha", "Saraiva"],
            "07/11/2025": ["Cristiano", "Teresinha", "Thiago"],
            "08/11/2025": ["Jeff", "Juliana", "Tais"],
            "09/11/2025": ["Jeff", "Luciana", "Edna"],
            "10/11/2025": ["Gui Mello", "Bona", "Tais"],
            "11/11/2025": ["Brozoza", "Loss", "Saraiva"],
            "12/11/2025": ["Cau", "Luciana", "Edna"],
            "13/11/2025": ["Melo", "C√°tia", "Jeff"],
            "14/11/2025": ["Piazza", "Bona", "Saraiva"],
            "15/11/2025": ["Gui Mello", "Th√°ssia", "Saraiva"],
            "16/11/2025": ["Gui Mello", "Loss", "Saraiva"],
            "17/11/2025": ["C√©sar", "Teresinha", "Jeff"],
            "18/11/2025": ["Dago", "C√°tia", "Edna"],
            "19/11/2025": ["Jeff", "Th√°ssia", "Saraiva"],
            "20/11/2025": ["Cristiano", "Juliana", "Thiago"],
            "21/11/2025": ["Gui Mello", "Melo", "Thiago"],
            "22/11/2025": ["Brozoza", "Loss", "Thiago"],
            "23/11/2025": ["Brozoza", "Loss", "Thiago"],
            "24/11/2025": ["Cau", "Luciana", "Saraiva"],
            "25/11/2025": ["Brozoza", "Loss", "Vanessa"],
            "26/11/2025": ["Melo", "Vanessa", "Jeff"],
            "27/11/2025": ["Piazza", "Gui Mello", "Tais"],
            "28/11/2025": ["C√©sar", "Juliana", "Vanessa"],
            "29/11/2025": ["Cau", "Luciana", "Edna"],
            "30/11/2025": ["Cau", "Juliana", "Edna"],
            "01/12/2025": ["Dago", "C√°tia", ""],
            "02/12/2025": ["Jeff", "Vanessa", ""],
            "03/12/2025": ["Cristiano", "Juliana", ""],
            "04/12/2025": ["Gui Mello", "Jeff", ""],
            "05/12/2025": ["Brozoza", "Loss", ""],
            "06/12/2025": ["Melo", "Th√°ssia", ""],
            "07/12/2025": ["Melo", "Th√°ssia", ""],
            "08/12/2025": ["Cau", "Luciana", ""],
            "09/12/2025": ["Melo", "Th√°ssia", ""],
            "10/12/2025": ["Piazza", "Bona", ""],
            "11/12/2025": ["C√©sar", "Teresinha", ""],
            "12/12/2025": ["Dago", "C√°tia", ""],
            "13/12/2025": ["Piazza", "Bona", ""],
            "14/12/2025": ["Piazza", "Bona", ""],
            "15/12/2025": ["Jeff", "Vanessa", ""],
            "16/12/2025": ["Cristiano", "Juliana", ""],
            "17/12/2025": ["Gui Mello", "Teresinha", ""],
            "18/12/2025": ["Brozoza", "Loss", ""],
            "19/12/2025": ["Cau", "Luciana", ""],
            "20/12/2025": ["C√©sar", "Teresinha", ""],
            "21/12/2025": ["C√©sar", "Teresinha", ""],
            "22/12/2025": ["Melo", "Th√°ssia", ""],
            "23/12/2025": ["Piazza", "Bona", ""],
            "24/12/2025": ["C√©sar", "Teresinha", ""],
            "25/12/2025": ["Dago", "C√°tia", ""],
            "26/12/2025": ["Jeff", "Vanessa", ""],
            "27/12/2025": ["Dago", "C√°tia", ""],
            "28/12/2025": ["Dago", "C√°tia", ""],
            "29/12/2025": ["Cristiano", "Juliana", ""],
            "30/12/2025": ["Gui Mello", "Brozoza", ""],
            "31/12/2025": ["Brozoza", "Loss", ""]
        };

        function getTodayBrasilia() {
            const now = new Date();
            const offset = -3;
            const brasiliaTime = new Date(now.getTime() + offset * 60 * 60 * 1000);
            
            const day = String(brasiliaTime.getUTCDate()).padStart(2, '0');
            const month = String(brasiliaTime.getUTCMonth() + 1).padStart(2, '0');
            const year = brasiliaTime.getUTCFullYear();
            
            return day + '/' + month + '/' + year;
        }

        function sortDates(dates) {
            return dates.sort((a, b) => {
                const [diaA, mesA, anoA] = a.split('/');
                const [diaB, mesB, anoB] = b.split('/');
                const dataA = new Date(anoA, mesA - 1, diaA);
                const dataB = new Date(anoB, mesB - 1, diaB);
                return dataA - dataB;
            });
        }

        function showTab(index) {
            const contents = document.querySelectorAll('.tab-content');
            const buttons = document.querySelectorAll('.tab-btn');
            
            contents.forEach((c, i) => {
                c.classList.remove('active');
                buttons[i].classList.remove('active');
            });
            
            contents[index].classList.add('active');
            buttons[index].classList.add('active');

            // Restaurar data em todas as abas
            if (lastSelectedDate) {
                document.getElementById('date-select').value = lastSelectedDate;
                document.getElementById('swap-date-select').value = lastSelectedDate;
            }

            // Se clicar na aba de Trocas e houver data selecionada, carregar automaticamente
            if (index === 2 && lastSelectedDate) {
                loadSwapOptions();
            }

            // Se voltar para Data ou Trocas, mostrar o texto da √∫ltima data
            if ((index === 0 || index === 2) && lastSelectedDate) {
                document.getElementById('output').value = buildMessage(lastSelectedDate);
            }

            // Se clicar em Pessoa, limpar o textarea
            if (index === 1) {
                document.getElementById('output').value = '';
                document.getElementById('person-select').value = '';
            }
        }

        function buildMessage(date, swaps = null) {
            let escala = schedule[date];
            if (!escala) return "";
            
            let [sa01, sa02, saNac] = escala;

            if (swaps) {
                if (swaps[0]) sa01 = peopleShortMap[swaps[0]];
                if (swaps[1]) sa02 = peopleShortMap[swaps[1]];
                if (swaps[2]) saNac = peopleShortMap[swaps[2]];
            }

            const nome1 = nameMap[sa01];
            const fone1 = phoneMap[sa01];
            const nome2 = nameMap[sa02];
            const fone2 = phoneMap[sa02];
            
            let text = "*Sobreaviso DRV/DEIC*\n";
            text += "Data: " + date + "\n\n";
            text += nome1 + "\n" + fone1 + "\n\n";
            text += nome2 + "\n" + fone2 + "\n\n";
            
            if (saNac && saNac !== "") {
                const nomeNac = nameMap[saNac];
                const foneNac = phoneMap[saNac];
                text += "NAC: " + nomeNac + "\n" + foneNac + "\n\n";
            }
            
            text += "Chefe de SI: Com. Bruna Caldeira\n";
            text += "(51) 99139-9403\n\n";
            text += "Autoridade Policial:\n";
            text += "Del. Jeiselaure de Souza\n";
            text += "(51) 99145-8919";
            
            return text;
        }

        function searchByDate() {
            const date = document.getElementById('date-select').value;
            if (!date) return;
            lastSelectedDate = date;
            document.getElementById('output').value = buildMessage(date);
        }

        function searchByPerson() {
            const personFull = document.getElementById('person-select').value;
            if (!personFull) {
                document.getElementById('output').value = '';
                return;
            }
            
            const personShort = peopleShortMap[personFull];
            let result = '';
            let novCount = 0;
            let decCount = 0;
            let datesFound = [];

            for (let date in schedule) {
                const escala = schedule[date];
                const sa01 = escala[0];
                const sa02 = escala[1];
                const saNac = escala[2];
                
                if (sa01 === personShort || sa02 === personShort || saNac === personShort) {
                    datesFound.push(date);
                    if (date.includes("/11/")) {
                        novCount++;
                    } else if (date.includes("/12/")) {
                        decCount++;
                    }
                }
            }

            datesFound = sortDates(datesFound);

            result += "Novembro: " + novCount + " sobreavisos\n";
            result += "Dezembro: " + decCount + " sobreavisos\n\n";
            result += "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n";

            for (let i = 0; i < datesFound.length; i++) {
                if (i > 0) {
                    result += "\n\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n";
                }
                result += buildMessage(datesFound[i]);
            }
            
            document.getElementById('output').value = result;
        }

        function loadSwapOptions() {
            const date = document.getElementById('swap-date-select').value;
            if (!date) {
                document.getElementById('swap-options-container').style.display = 'none';
                return;
            }

            lastSelectedDate = date;

            const escala = schedule[date];
            if (!escala) return;

            const [sa01Short, sa02Short, saNacShort] = escala;
            const names = [];
            names[0] = nameMap[sa01Short];
            names[1] = nameMap[sa02Short];
            if (saNacShort && saNacShort !== "") {
                names[2] = nameMap[saNacShort];
            } else {
                names[2] = "(Sem NAC neste dia)";
            }

            for (let i = 1; i <= 3; i++) {
                const elem = document.getElementById('swap-person-' + i);
                elem.innerHTML = '<option value="">-- ' + names[i-1] + ' --</option>';
                elem.value = '';

                const forElem = document.getElementById('swap-for-' + i);
                forElem.innerHTML = '<option value="">-- Selecione --</option>';
                allPeople.forEach(person => {
                    forElem.innerHTML += '<option value="' + person + '">' + person + '</option>';
                });
            }

            document.getElementById('swap-options-container').style.display = 'block';
            updateSwapMessage();
        }

        function updateSwapMessage() {
            const date = document.getElementById('swap-date-select').value;
            if (!date) return;

            const swaps = [];
            for (let i = 1; i <= 3; i++) {
                const forVal = document.getElementById('swap-for-' + i).value;
                swaps.push(forVal || null);
            }

            document.getElementById('output').value = buildMessage(date, swaps);
        }

        function copyText() {
            const text = document.getElementById('output').value;
            if (!text) {
                alert('Nenhum texto para copiar!');
                return;
            }
            navigator.clipboard.writeText(text).then(() => {
                alert('‚úÖ Texto copiado!');
            });
        }

        function sendWhatsApp() {
            const text = document.getElementById('output').value;
            if (!text) {
                alert('Nenhum texto para enviar!');
                return;
            }
            const encoded = encodeURIComponent(text);
            window.open(`https://wa.me/?text=${encoded}`, '_blank');
        }

        function clearAll() {
            document.getElementById('output').value = '';
            document.getElementById('date-select').value = '';
            document.getElementById('person-select').value = '';
            document.getElementById('swap-date-select').value = '';
            document.getElementById('swap-options-container').style.display = 'none';
            lastSelectedDate = null;
        }

        window.addEventListener('DOMContentLoaded', function() {
            const todayDate = getTodayBrasilia();
            if (schedule[todayDate]) {
                lastSelectedDate = todayDate;
                document.getElementById('date-select').value = todayDate;
                document.getElementById('output').value = buildMessage(todayDate);
            }
        });
    </script>
</body>
</html>
