<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Sobreaviso DRV/DEIC</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: #f5f5f5;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: #2563eb;
            color: white;
            padding: 30px 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }

        .tabs {
            display: flex;
            background: #f0f0f0;
            border-bottom: 2px solid #ddd;
        }

        .tab-btn {
            flex: 1;
            padding: 15px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            color: #666;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }

        .tab-btn.active {
            background: white;
            color: #2563eb;
            border-bottom-color: #2563eb;
        }

        .tab-btn:hover {
            background: #f9f9f9;
        }

        .content {
            padding: 30px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: #333;
        }

        select, textarea {
            width: 100%;
            padding: 12px;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            font-family: Arial, sans-serif;
        }

        select {
            cursor: pointer;
        }

        textarea {
            height: 350px;
            resize: vertical;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }

        .swap-container {
            background: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .swap-row {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 12px;
            align-items: end;
            margin-bottom: 12px;
        }

        .swap-row:last-child {
            margin-bottom: 0;
        }

        .swap-row label {
            margin-bottom: 5px;
        }

        .swap-row select {
            margin-bottom: 0;
        }

        .swap-arrow {
            text-align: center;
            font-weight: bold;
            color: #2563eb;
            font-size: 18px;
        }

        .filter-row {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .filter-row div {
            flex: 1;
        }

        .filter-row label {
            margin-bottom: 8px;
        }

        .filter-row select {
            margin-bottom: 0;
        }

        .month-summary {
            background: #e3f2fd;
            border-left: 4px solid #2563eb;
            padding: 12px;
            margin-bottom: 15px;
            border-radius: 4px;
            font-weight: bold;
            color: #1d4ed8;
            display: none;
        }

        .buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 15px;
            font-weight: bold;
            transition: all 0.3s;
            flex: 1;
            min-width: 120px;
        }

        .btn-copy {
            background: #2563eb;
            color: white;
        }

        .btn-copy:hover {
            background: #1d4ed8;
        }

        .btn-whatsapp {
            background: #16a34a;
            color: white;
        }

        .btn-whatsapp:hover {
            background: #15803d;
        }

        .btn-clear {
            background: #6b7280;
            color: white;
        }

        .btn-clear:hover {
            background: #4b5563;
        }

        @media (max-width: 600px) {
            .header h1 {
                font-size: 20px;
            }

            .tabs {
                flex-direction: column;
            }

            textarea {
                height: 250px;
            }

            button {
                min-width: 100%;
            }

            .tab-btn {
                font-size: 14px;
                padding: 10px;
            }

            .swap-row {
                grid-template-columns: 1fr;
            }

            .swap-arrow {
                display: none;
            }

            .filter-row {
                flex-direction: column;
                gap: 0;
            }

            .filter-row div {
                margin-bottom: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìã Gerador de Sobreaviso DRV/DEIC</h1>
        </div>

        <div class="tabs">
            <button class="tab-btn active" onclick="showTab(0)">üìÖ Buscar por Data</button>
            <button class="tab-btn" onclick="showTab(1)">üë§ Buscar por Pessoa</button>
            <button class="tab-btn" onclick="showTab(2)">üîÑ Trocas</button>
        </div>

        <div class="content">
            <!-- ABA 1: BUSCAR POR DATA -->
            <div class="tab-content active">
                <label for="date-select">Selecione a </label>
                <select id="date-select" onchange="searchByDate()">
                    <option value="">-- Escolha uma data --</option>
                </select>
            </div>

            <!-- ABA 2: BUSCAR POR PESSOA -->
            <div class="tab-content">
                <div class="filter-row">
                    <div>
                        <label for="person-select">Selecione uma pessoa:</label>
                        <select id="person-select" onchange="searchByPerson()">
                            <option value="">-- Escolha uma pessoa --</option>
                            <option>Insp. Acau√£</option>
                            <option>Insp. Alexandre Brozoza</option>
                            <option>Esc. Anderson Saraiva</option>
                            <option>Esc. C√°tia Fortunato</option>
                            <option>Esc. C√©sar da Costa</option>
                            <option>Insp. Cristiano Soletti</option>
                            <option>Esc. Dagoberto O. das Virgens</option>
                            <option>Insp. Edmilson Melo</option>
                            <option>Insp. Edna Moraes</option>
                            <option>Esc. Fernanda Piazza</option>
                            <option>Insp. Guilherme Mello</option>
                            <option>Esc. Jefferson Antoniol</option>
                            <option>Insp. Juliana Tremper</option>
                            <option>Insp. Juliano Bonacina</option>
                            <option>Insp. Lucas Loss</option>
                            <option>Esc. Luciana Bortoli</option>
                            <option>Insp. Tais Boesing</option>
                            <option>Com. Teresinha Carivali</option>
                            <option>Insp. Th√°ssia Guterres</option>
                            <option>Insp. Thiago Meireles</option>
                            <option>Insp. Vanessa Trindade</option>
                        </select>
                    </div>
                    <div>
                        <label for="month-filter">Filtrar por m√™s (opcional):</label>
                        <select id="month-filter" onchange="searchByPerson()">
                            <option value="">-- Todos os meses --</option>
                            <option value="12">Dezembro 2025</option>
                            <option value="01">Janeiro 2026</option>
                        </select>
                    </div>
                </div>

                <div class="month-summary" id="month-summary"></div>
            </div>

            <!-- ABA 3: TROCAS -->
            <div class="tab-content">
                <label for="swap-date-select">Selecione a data da troca:</label>
                <select id="swap-date-select" onchange="loadSwapOptions()">
                    <option value="">-- Escolha uma data --</option>
                </select>

                <div class="swap-container" id="swap-options-container" style="display: none;">
                    <div class="swap-row">
                        <div>
                            <label for="swap-person-1">Quem est√°:</label>
                            <select id="swap-person-1" onchange="updateSwapMessage()">
                                <option value="">-- Selecione --</option>
                            </select>
                        </div>
                        <div class="swap-arrow">‚Üí</div>
                        <div>
                            <label for="swap-for-1">Vai trocar para:</label>
                            <select id="swap-for-1" onchange="updateSwapMessage()">
                                <option value="">-- Selecione --</option>
                            </select>
                        </div>
                    </div>

                    <div class="swap-row">
                        <div>
                            <label for="swap-person-2">Quem est√°:</label>
                            <select id="swap-person-2" onchange="updateSwapMessage()">
                                <option value="">-- Selecione --</option>
                            </select>
                        </div>
                        <div class="swap-arrow">‚Üí</div>
                        <div>
                            <label for="swap-for-2">Vai trocar para:</label>
                            <select id="swap-for-2" onchange="updateSwapMessage()">
                                <option value="">-- Selecione --</option>
                            </select>
                        </div>
                    </div>

                    <div class="swap-row">
                        <div>
                            <label for="swap-person-3">Quem est√°:</label>
                            <select id="swap-person-3" onchange="updateSwapMessage()">
                                <option value="">-- Selecione --</option>
                            </select>
                        </div>
                        <div class="swap-arrow">‚Üí</div>
                        <div>
                            <label for="swap-for-3">Vai trocar para:</label>
                            <select id="swap-for-3" onchange="updateSwapMessage()">
                                <option value="">-- Selecione --</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <textarea id="output" placeholder="O texto do sobreaviso aparecer√° aqui..." readonly></textarea>

            <div class="buttons">
                <button class="btn-copy" onclick="copyText()">üìã Copiar Texto</button>
                <button class="btn-whatsapp" onclick="sendWhatsApp()">üíö Enviar no WhatsApp</button>
                <button class="btn-clear" onclick="clearTab()">üóëÔ∏è Limpar</button>
            </div>
        </div>
    </div>

    <script>
        let lastSelectedDate = null;
        let currentTab = 0;
        let isSearchingByPerson = false;

        const nameMap = {
            "Cau": "Insp. Acau√£",
            "Piazza": "Esc. Fernanda Piazza",
            "Cristiano": "Insp. Cristiano Soletti",
            "Teresinha": "Com. Teresinha Carivali",
            "Thiago": "Insp. Thiago Meireles",
            "C√©sar": "Esc. C√©sar da Costa",
            "Vanessa": "Insp. Vanessa Trindade",
            "Bona": "Insp. Juliano Bonacina",
            "Gui Mello": "Insp. Guilherme Mello",
            "Tais": "Insp. Tais Boesing",
            "Jeff": "Esc. Jefferson Antoniol",
            "Luciana": "Esc. Luciana Bortoli",
            "Edna": "Insp. Edna Moraes",
            "Saraiva": "Esc. Anderson Saraiva",
            "Loss": "Insp. Lucas Loss",
            "Brozoza": "Insp. Alexandre Brozoza",
            "Dago": "Esc. Dagoberto O. das Virgens",
            "Th√°ssia": "Insp. Th√°ssia Guterres",
            "Juliana": "Insp. Juliana Tremper",
            "C√°tia": "Esc. C√°tia Fortunato",
            "Melo": "Insp. Edmilson Melo"
        };

        const phoneMap = {
            "Cau": "(51) 986859065",
            "Piazza": "(51) 993605744",
            "Cristiano": "(51) 995659880",
            "Teresinha": "(51) 999829606",
            "Thiago": "(79) 988080613",
            "C√©sar": "(51) 998911160",
            "Vanessa": "(55) 984278960",
            "Bona": "(51) 989276060",
            "Gui Mello": "(51) 981354933",
            "Tais": "(51) 980549435",
            "Jeff": "(24) 981002933",
            "Luciana": "(51) 993935552",
            "Edna": "(53) 981339654",
            "Saraiva": "(51) 993879343",
            "Loss": "(51) 991055571",
            "Brozoza": "(51) 996500506",
            "Dago": "(51) 999920066",
            "Th√°ssia": "(51) 996499862",
            "Juliana": "(51) 993337587",
            "C√°tia": "(51) 985744501",
            "Melo": "(51) 983190815"
        };

        const peopleShortMap = {
            "Insp. Acau√£": "Cau",
            "Insp. Alexandre Brozoza": "Brozoza",
            "Esc. Anderson Saraiva": "Saraiva",
            "Esc. C√°tia Fortunato": "C√°tia",
            "Esc. C√©sar da Costa": "C√©sar",
            "Insp. Cristiano Soletti": "Cristiano",
            "Esc. Dagoberto O. das Virgens": "Dago",
            "Insp. Edmilson Melo": "Melo",
            "Insp. Edna Moraes": "Edna",
            "Esc. Fernanda Piazza": "Piazza",
            "Insp. Guilherme Mello": "Gui Mello",
            "Esc. Jefferson Antoniol": "Jeff",
            "Insp. Juliana Tremper": "Juliana",
            "Insp. Juliano Bonacina": "Bona",
            "Insp. Lucas Loss": "Loss",
            "Esc. Luciana Bortoli": "Luciana",
            "Insp. Tais Boesing": "Tais",
            "Com. Teresinha Carivali": "Teresinha",
            "Insp. Th√°ssia Guterres": "Th√°ssia",
            "Insp. Thiago Meireles": "Thiago",
            "Insp. Vanessa Trindade": "Vanessa"
        };

        const allPeople = [
            "Insp. Acau√£",
            "Insp. Alexandre Brozoza",
            "Esc. Anderson Saraiva",
            "Esc. C√°tia Fortunato",
            "Esc. C√©sar da Costa",
            "Insp. Cristiano Soletti",
            "Esc. Dagoberto O. das Virgens",
            "Insp. Edmilson Melo",
            "Insp. Edna Moraes",
            "Esc. Fernanda Piazza",
            "Insp. Guilherme Mello",
            "Esc. Jefferson Antoniol",
            "Insp. Juliana Tremper",
            "Insp. Juliano Bonacina",
            "Insp. Lucas Loss",
            "Esc. Luciana Bortoli",
            "Insp. Tais Boesing",
            "Com. Teresinha Carivali",
            "Insp. Th√°ssia Guterres",
            "Insp. Thiago Meireles",
            "Insp. Vanessa Trindade"
        ];

        /* ‚úÖ ATUALIZADO CONFORME A TABELA DA IMAGEM (01/01/2026 a 02/01/2027) */
        const schedule = {
            "01/01/2026": ["quinta-feira", "Jeff", "Cristiano", "Edna"],
            "02/01/2026": ["sexta-feira", "Cau", "C√°tia", "Dago"],
            "03/01/2026": ["s√°bado", "Jeff", "Cristiano", "Edna"],
            "04/01/2026": ["domingo", "Jeff", "Cristiano", "Edna"],
            "05/01/2026": ["segunda-feira", "Melo", "Teresinha", "Juliana"],
            "06/01/2026": ["ter√ßa-feira", "Brozoza", "Piazza", "Gui Mello"],
            "07/01/2026": ["quarta-feira", "Jeff", "Cristiano", "Edna"],
            "08/01/2026": ["quinta-feira", "Cau", "C√°tia", "Cristiano"],
            "09/01/2026": ["sexta-feira", "Melo", "Piazza", "Juliana"],
            "10/01/2026": ["s√°bado", "Cau", "Teresinha", "Piazza"],
            "11/01/2026": ["domingo", "Cau", "Teresinha", "Piazza"],
            "12/01/2026": ["segunda-feira", "Melo", "Piazza", "Gui Mello"],
            "13/01/2026": ["ter√ßa-feira", "Jeff", "Cristiano", "Edna"],
            "14/01/2026": ["quarta-feira", "Cau", "Teresinha", "Cristiano"],
            "15/01/2026": ["quinta-feira", "Brozoza", "Teresinha", "Juliana"],
            "16/01/2026": ["sexta-feira", "Brozoza", "C√°tia", "Edna"],
            "17/01/2026": ["s√°bado", "Brozoza", "C√°tia", "Juliana"],
            "18/01/2026": ["domingo", "Melo", "C√°tia", "Juliana"],
            "19/01/2026": ["segunda-feira", "Jeff", "Teresinha", "Gui Mello"],
            "20/01/2026": ["ter√ßa-feira", "Cau", "C√°tia", "Dago"],
            "21/01/2026": ["quarta-feira", "Melo", "Cristiano", "Juliana"],
            "22/01/2026": ["quinta-feira", "Loss", "Luciana", "Thiago"],
            "23/01/2026": ["sexta-feira", "Th√°ssia", "Melo", "Saraiva"],
            "24/01/2026": ["s√°bado", "Brozoza", "Vanessa", ""],
            "25/01/2026": ["domingo", "Brozoza", "Vanessa", ""],
            "26/01/2026": ["segunda-feira", "Dago", "C√©sar", "Juliana"],
            "27/01/2026": ["ter√ßa-feira", "Dago", "Bona", "Vanessa"],
            "28/01/2026": ["quarta-feira", "Loss", "Luciana", "Thiago"],
            "29/01/2026": ["quinta-feira", "Th√°ssia", "Melo", "Saraiva"],
            "30/01/2026": ["sexta-feira", "Bona", "C√©sar", "Juliana"],
            "31/01/2026": ["s√°bado", "Dago", "Cristiano", ""],
            "02/01/2027": ["s√°bado", "", "", ""]
        };

        function populateDateSelects() {
            const dates = Object.keys(schedule).sort((a, b) => {
                const [diaA, mesA, anoA] = a.split('/');
                const [diaB, mesB, anoB] = b.split('/');
                const dataA = new Date(anoA, mesA - 1, diaA);
                const dataB = new Date(anoB, mesB - 1, diaB);
                return dataA - dataB;
            });

            const dateSelect = document.getElementById('date-select');
            const swapDateSelect = document.getElementById('swap-date-select');

            dates.forEach(date => {
                const option1 = document.createElement('option');
                option1.value = date;
                option1.textContent = date;
                dateSelect.appendChild(option1);

                const option2 = document.createElement('option');
                option2.value = date;
                option2.textContent = date;
                swapDateSelect.appendChild(option2);
            });
        }

        function getTodayBrasilia() {
            const now = new Date();
            const offset = -3;
            const brasiliaTime = new Date(now.getTime() + offset * 60 * 60 * 1000);

            const day = String(brasiliaTime.getUTCDate()).padStart(2, '0');
            const month = String(brasiliaTime.getUTCMonth() + 1).padStart(2, '0');
            const year = brasiliaTime.getUTCFullYear();

            return day + '/' + month + '/' + year;
        }

        function getDayOfWeek(dateString) {
            const data = schedule[dateString];
            if (data && data.length > 0) {
                return data[0];
            }
            return "";
        }

        function sortDates(dates) {
            return dates.sort((a, b) => {
                const [diaA, mesA, anoA] = a.split('/');
                const [diaB, mesB, anoB] = b.split('/');
                const dataA = new Date(anoA, mesA - 1, diaA);
                const dataB = new Date(anoB, mesB - 1, diaB);
                return dataA - dataB;
            });
        }

        function getMonthName(month) {
            const months = {
                "12": "Dezembro",
                "01": "Janeiro"
            };
            return months[month] || "";
        }

        function showTab(index) {
            currentTab = index;
            const contents = document.querySelectorAll('.tab-content');
            const buttons = document.querySelectorAll('.tab-btn');

            contents.forEach((c, i) => {
                c.classList.remove('active');
                buttons[i].classList.remove('active');
            });

            contents[index].classList.add('active');
            buttons[index].classList.add('active');

            if (index === 0) {
                const todayDate = getTodayBrasilia();
                document.getElementById('date-select').value = todayDate;
                if (schedule[todayDate]) {
                    document.getElementById('output').value = buildMessage(todayDate);
                }
            }

            if (index === 2 && lastSelectedDate) {
                document.getElementById('swap-date-select').value = lastSelectedDate;
                loadSwapOptions();
            }

            if (index === 1) {
                document.getElementById('output').value = '';
                document.getElementById('person-select').value = '';
                document.getElementById('month-filter').value = '';
                document.getElementById('month-summary').style.display = 'none';
            }
        }

        function buildMessage(date, swaps = null) {
            let escala = schedule[date];
            if (!escala || escala.length < 2) return "";

            let [dayOfWeek, sa01, sa02, saNac] = escala;

            if (swaps) {
                if (swaps[0]) sa01 = peopleShortMap[swaps[0]];
                if (swaps[1]) sa02 = peopleShortMap[swaps[1]];
                if (swaps[2]) saNac = peopleShortMap[swaps[2]];
            }

            const nome1 = nameMap[sa01];
            const fone1 = phoneMap[sa01];
            const nome2 = nameMap[sa02];
            const fone2 = phoneMap[sa02];

            let text = "*Sobreaviso DRV/DEIC*\n";

            if (isSearchingByPerson) {
                text += "Data: " + date + " (" + dayOfWeek + ")\n\n";
            } else {
                text += "Data: " + date + "\n\n";
            }

            if (nome1 && fone1) {
                text += nome1 + "\n" + fone1 + "\n\n";
            } else if (nome1) {
                text += nome1 + "\n\n";
            }

            if (nome2 && fone2) {
                text += nome2 + "\n" + fone2 + "\n\n";
            } else if (nome2) {
                text += nome2 + "\n\n";
            }

            if (saNac && saNac !== "") {
                const nomeNac = nameMap[saNac];
                const foneNac = phoneMap[saNac];
                if (nomeNac && foneNac) {
                    text += "NAC: " + nomeNac + "\n" + foneNac + "\n\n";
                }
            }

            text += "Chefe de SI: Com. Bruna Caldeira\n";
            text += "(51) 99139-9403\n\n";
            text += "Autoridade Policial:\n";
            text += "Del. Jeiselaure de Souza\n";
            text += "(51) 99145-8919";

            return text;
        }

        function searchByDate() {
            isSearchingByPerson = false;
            const date = document.getElementById('date-select').value;
            if (!date) return;
            lastSelectedDate = date;
            document.getElementById('output').value = buildMessage(date);
        }

        function searchByPerson() {
            isSearchingByPerson = true;
            const personFull = document.getElementById('person-select').value;
            const monthFilter = document.getElementById('month-filter').value;
            const summaryDiv = document.getElementById('month-summary');

            if (!personFull) {
                document.getElementById('output').value = '';
                summaryDiv.style.display = 'none';
                return;
            }

            const personShort = peopleShortMap[personFull];
            let result = '';
            let decCount = 0;
            let janCount = 0;
            let datesFound = [];

            Object.keys(schedule).forEach(date => {
                const escala = schedule[date];
                if (escala.length < 2) return;

                const sa01 = escala[1];
                const sa02 = escala[2];
                const saNac = escala[3];

                if (sa01 === personShort || sa02 === personShort || saNac === personShort) {
                    datesFound.push(date);
                    if (date.includes("/12/")) {
                        decCount++;
                    } else if (date.includes("/01/")) {
                        janCount++;
                    }
                }
            });

            datesFound = sortDates(datesFound);

            if (monthFilter) {
                datesFound = datesFound.filter(date => {
                    const dateParts = date.split('/');
                    return dateParts[1] === monthFilter;
                });

                const monthName = getMonthName(monthFilter);
                summaryDiv.textContent = monthName + ": " + datesFound.length + " sobreavisos";
                summaryDiv.style.display = 'block';
            } else {
                if (decCount > 0) result += "Dezembro: " + decCount + " sobreavisos\n";
                if (janCount > 0) result += "Janeiro: " + janCount + " sobreavisos\n";
                result += "\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n";
                summaryDiv.style.display = 'none';
            }

            for (let i = 0; i < datesFound.length; i++) {
                if (i > 0) {
                    result += "\n\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n";
                }
                result += buildMessage(datesFound[i]);
            }

            document.getElementById('output').value = result;
        }

        function loadSwapOptions() {
            isSearchingByPerson = false;
            const date = document.getElementById('swap-date-select').value;
            if (!date) {
                document.getElementById('swap-options-container').style.display = 'none';
                return;
            }

            lastSelectedDate = date;

            const escala = schedule[date];
            if (!escala || escala.length < 2) return;

            const sa01Short = escala[1];
            const sa02Short = escala[2];
            const saNacShort = escala[3];

            const names = [];
            names[0] = nameMap[sa01Short] || "(Vazio)";
            names[1] = nameMap[sa02Short] || "(Vazio)";
            if (saNacShort && saNacShort !== "") {
                names[2] = nameMap[saNacShort];
            } else {
                names[2] = "(Sem NAC neste dia)";
            }

            for (let i = 1; i <= 3; i++) {
                const elem = document.getElementById('swap-person-' + i);
                elem.innerHTML = '<option value="">-- ' + names[i-1] + ' --</option>';
                elem.value = '';

                const forElem = document.getElementById('swap-for-' + i);
                forElem.innerHTML = '<option value="">-- Selecione --</option>';
                allPeople.forEach(person => {
                    forElem.innerHTML += '<option value="' + person + '">' + person + '</option>';
                });
            }

            document.getElementById('swap-options-container').style.display = 'block';
            updateSwapMessage();
        }

        function updateSwapMessage() {
            isSearchingByPerson = false;
            const date = document.getElementById('swap-date-select').value;
            if (!date) return;

            const swaps = [];
            for (let i = 1; i <= 3; i++) {
                const forVal = document.getElementById('swap-for-' + i).value;
                swaps.push(forVal || null);
            }

            document.getElementById('output').value = buildMessage(date, swaps);
        }

        function copyText() {
            const text = document.getElementById('output').value;
            if (!text) {
                alert('Nenhum texto para copiar!');
                return;
            }
            navigator.clipboard.writeText(text).then(() => {
                alert('‚úÖ Texto copiado!');
            });
        }

        function sendWhatsApp() {
            const text = document.getElementById('output').value;
            if (!text) {
                alert('Nenhum texto para enviar!');
                return;
            }
            const encoded = encodeURIComponent(text);
            window.open(`https://wa.me/?text=${encoded}`, '_blank');
        }

        function clearTab() {
            document.getElementById('output').value = '';

            if (currentTab === 0) {
                document.getElementById('date-select').value = '';
            } else if (currentTab === 1) {
                document.getElementById('person-select').value = '';
                document.getElementById('month-filter').value = '';
                document.getElementById('month-summary').style.display = 'none';
            } else if (currentTab === 2) {
                document.getElementById('swap-date-select').value = '';
                document.getElementById('swap-options-container').style.display = 'none';
                for (let i = 1; i <= 3; i++) {
                    document.getElementById('swap-person-' + i).value = '';
                    document.getElementById('swap-for-' + i).value = '';
                }
            }
        }

        window.addEventListener('DOMContentLoaded', function() {
            populateDateSelects();
            const todayDate = getTodayBrasilia();
            if (schedule[todayDate]) {
                lastSelectedDate = todayDate;
                document.getElementById('date-select').value = todayDate;
                document.getElementById('output').value = buildMessage(todayDate);
            }
        });
    </script>
</body>
</html>
